<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
<title>Parameter Converters</title>
</head>

<body>

<h2>Parameter Converters</h2>

<h3>Build-in support for Java types and Lists</h3>

<p>JBehave automatically converts the textual representation of a
parameter extracted from the candidate step with the parameter type of
the matched method in the Steps class. Let's go back to our example to
make this point clear. Consider a single textual step:</p>
<pre class="brush: bdd">
    Given a stock of symbol STK1 and a threshold of 10.0
</pre>
<p>which we map to the Java method:</p>
<pre class="brush: java">
    @Given("a stock of symbol $symbol and a threshold of $threshold")
    public void aStock(String symbol, double threshold) {
        // ...
    }
</pre>
<p>The two arguments which are identified as parameters in matching
the textual step to the annotation pattern are: "STK1" and "1.0". These
are converted respectively to a <b>String</b> and a <b>double</b>.</p>
<p>If we had comma-separated values, e.g</p>
<pre class="brush: bdd">
    Given a stock of symbols STK1,STK2 and thresholds of 10.0,20.0
</pre>
<p>these would handled automatically as well, provided the type of
the parameter was a <a
    href="http://java.sun.com/j2se/1.5.0/docs/api/java/util/List.html">List</a></p>
<script type="syntaxhighlighter" class="brush: java"><![CDATA[
    @Given("a stock of symbols $symbols and thresholds $thresholds")
    public void aStock(List<String> symbols, List<Double> thresholds) {
        // ...
    }
]]></script>
<p>More in general, JBehave provides out-of-the-box support for
Strings, numbers and the lists thereof.</p>

<h3>ParameterConverter interface</h3>

<p>At the core of the parameter conversion mechanism lies the <a
    href="javadoc/core/org/jbehave/core/steps/ParameterConverters.html">ParameterConverters</a>
facade and the interface:
<pre class="brush: java">
public static interface ParameterConverter {
 
  boolean accept(Type type);
 
  Object convertValue(String value, Type type);
 
}
</pre>
<p>The built-in support for Java types is provided by
implementations of this interface. Specifically:</p>
<ul>
    <li>NumberConverter</li>
    <li>NumberListConverter</li>
    <li>StringListConverter</li>
    <li>DateConverter</li>
    <li>ExamplesTableConverter</li>
</ul>

<h3>Custom parameter converters</h3>

<p>For example, let's consider the case of date conversion, a rather
common one. The step would typically look like:</p>
<pre class="brush: bdd">
    When a stock of symbol STK1 is traded on 09/09/2009
</pre>
<p>and the matching step is</p>
<pre class="brush: java">
    @When("a stock of symbol $symbol is traded on $tradedOn")
    public void aStockIsTradedOn(String symbol, Date tradedOn) {
        // ...
    }
</pre>
<p>Out of the box, JBehave provides a  <a
    href="javadoc/core/org/jbehave/core/steps/ParameterConverters#DateConverter.html">DateConverter</a>
backed up with a <a
    href="http://java.sun.com/j2se/1.5.0/docs/api/java/text/SimpleDateFormat.html">SimpleDateFormat</a>
    with format <b>dd/MM/yyyy</b>.  To configure the use of a<b>DateConverter</b> with a different date pattern:
</p>
<pre class="brush: java">
    public MyStory() {
        useConfiguration(new MostUseflConfiguration()
            .useParameterConverters(new ParameterConverters()
               .addConverter(new DateConverter(new SimpleDateFormat("yyyy-MM-dd")))));  // date converter with custom date pattern
    }

</pre>

<h3>Annotated methods as parameter converters</h3>

<p>In some cases defining the converter in Configuration is not an option as the conversion is much more dynamical 
in nature.  In this case, one can annotated Steps method to act as parameter converters when annotated by 
<a href="javadoc/core/org/jbehave/core/annotations/AsParameterConverter.html">@AsParameterConverter</a>:
</p>

<pre class="brush: java">
    public MySteps() {
        // Method used as dynamical parameter converter
        @AsParameterConverter
        public Trader createTrader(String name){
            return mockTradePersister().retrieveTrader(name);
        }
    
        private TraderPersister mockTradePersister() {
            return new TraderPersister(new Trader("Mauro", asList(new Stock("STK1",
                10.d))));
        }

    }
</pre>
<p>The parameter converter configuration is done in the 
<a href="javadoc/core/org/jbehave/core/steps/AbstractStepsFactory.html">AbstractStepsFactory</a>
so you can use any implementation of <a href="javadoc/core/org/jbehave/core/steps/InjectableStepsFactory.html">InjectableStepsFactory</a>
that extends the abstract implementation, e.g.:</p>
<pre class="brush: java">
    public MyStory() {
        addSteps(new InstanceStepsFactory(configuration(), new MySteps()).createCandidateSteps());
    }
</pre>

<div class="clear">
<hr />
</div>

</body>
</html>