<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
<title>Meta Filtering</title>
</head>

<body>

<h2>Meta Matchers</h2>

<p>One of the principal use cases for defining <a
	href="meta-info.html">meta info</a> in our stories is to be able to
filter the stories based on the meta info provided.</p>

<p>A meta filter is represented as a string and supports multiple meta matcher languages based on the prefix used:</p>

<ul>
<li>default meta matcher:  activated if no known prefix is found</li>
<li>groovy meta matcher: needs to prefixed by <b>groovy:</b></li>
</ul>

<h3>Default Meta Matcher</h3>

<p>The default meta matcher has a very simple language structure that mirrors that of the meta
properties, expressed as a sequence of name-value patterns:</p>
<pre class="brush: plain">
   default meta matcher :== ([+|-] [name] [value pattern])+
</pre>
<p>where <b>[+|-]</b> indicates if the filter should include or
exclude the meta property and the <b>[value pattern]</b> can be either
an exact match of the property value (including empty value) or use the
<b>*</b> matching notation.</p>

<p>The following are all valid meta matchers:</p>
<pre class="brush: plain">
   +author Mauro
   +theme filtering
   +author * +theme filtering
   +author * +theme filtering -skip
   -skip
</pre>

<p>A few examples of meta matchers and properties that matched or not:
<table class="bodyTable">
<thead><th>Meta Matcher</th><th>Meta Property</th><th>Matched</th></thead>
<tbody>
<tr class="a"><td>+theme smoke testing -skip</td><td>@theme smoke testing</td><td>true</td></tr>
<tr class="b"><td>+theme smoke testing -skip</td><td>@skip</td><td>false</td></tr>
<tr class="a"><td>+theme smoke testing</td><td>@theme smoke testing</td><td>true</td></tr>
<tr class="b"><td>+theme smoke testing</td><td>@theme testing</td><td>false</td></tr>
<tr class="a"><td>-skip</td><td>@theme testing</td><td>true</td></tr>
<tr class="b"><td>-skip</td><td>@skip</td><td>false</td></tr>
<tr class="a"><td>+theme smoke testing -theme UI</td><td>@theme smoke testing</td><td>true</td></tr>
<tr class="b"><td>+theme smoke testing -theme UI</td><td>@theme UI</td><td>false</td></tr>
</tbody>
</table>
</p>

<h3>Groovy Meta Matcher</h3>

<p>The Groovy meta matcher allows the logic of the matching to be expressed in Groovy using the values of the meta property names and values:</p>

<p>The following are all valid meta matchers (excluding the "groovy:" prefix):</p>
<pre class="brush: plain">
   author == 'Mauro'
   theme == 'filtering' || author != 'Mauro' 
</pre>

<span class="followup">As Groovy is an optional dependency, users wanting to use the Groovy Meta Matcher need to 
add it to the runtime classpath.  If using Maven, you need to define Groovy as a Plugin dependency, c.f. <a href="maven-goals.html">Maven goals</a>.
</span>

<h2>Configuring Meta Filters</h2>

<p>As usual, JBehave allow multiple equivalent ways of
configuration. One can specify the meta filters directly via the
Embedder, either programmatically or via the annotation:</p>

<pre class="brush: java">

Embedder embedder = ... // define as required
embedder.useMetaFilters(asList("+author Mauro", "+theme filtering", "-skip"));
    
</pre>

<pre class="brush: java">

@RunWith(AnnotatedEmbedderRunner.class)
@UsingEmbedder(metaFilters = {"+author Mauro", "+theme filtering", "-skip"})
public class AnnotatedTraderEmbedder extends InjectableEmbedder {
}
</pre>

<p>The meta filters can also be specified via <a
    href="ant-tasks.html">Ant tasks</a> or <a href="maven-goals.html">Maven
goals</a>, using the "metaFilters" attribute or configuration element.</p>

<span class="followup">Note that because of its additive
sequential nature, the meta filters will all be joined together when
running the stories. Have different meta filters comes into play when
doing <a href="story-mapping.html">story mapping</a>.</span>

<div class="clear">
<hr />
</div>

</body>
</html>
